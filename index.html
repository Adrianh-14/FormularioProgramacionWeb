<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Comentarios - Con Base de Datos</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .main-container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        margin: 50px auto;
        padding: 40px;
      }

      .comment-form {
        background: linear-gradient(145deg, #f8f9fa, #e9ecef);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 40px;
        border: 1px solid rgba(0, 0, 0, 0.1);
      }

      .comment-item {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        border-left: 4px solid #667eea;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .comment-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      .comment-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
      }

      .user-avatar {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        margin-right: 15px;
        font-size: 20px;
      }

      .comment-meta {
        flex-grow: 1;
      }

      .username {
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
      }

      .comment-date {
        color: #666;
        font-size: 0.9em;
      }

      .comment-text {
        color: #444;
        line-height: 1.6;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea, #764ba2);
        border: none;
        border-radius: 25px;
        padding: 12px 30px;
        transition: all 0.3s ease;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      }

      .form-control {
        border-radius: 10px;
        border: 2px solid #e9ecef;
        transition: border-color 0.3s ease;
      }

      .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
      }

      .no-comments {
        text-align: center;
        color: #666;
        font-style: italic;
        padding: 40px;
      }

      .header-title {
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-align: center;
        margin-bottom: 30px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="main-container">
        <h1 class="header-title">
          <i class="fas fa-comments"></i> Sistema de Comentarios - Con Base de
          Datos
        </h1>

        <!-- Formulario para agregar comentarios -->
        <div class="comment-form">
          <h3 class="mb-4">
            <i class="fas fa-plus-circle"></i> Agregar Comentario
          </h3>
          <form id="commentForm">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="name" class="form-label">Nombre:</label>
                <input
                  type="text"
                  class="form-control"
                  id="name"
                  name="name"
                  required
                />
              </div>
              <div class="col-md-6 mb-3">
                <label for="email" class="form-label">Email:</label>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  name="email"
                  required
                />
              </div>
            </div>
            <div class="mb-3">
              <label for="comment" class="form-label">Comentario:</label>
              <textarea
                class="form-control"
                id="comment"
                name="comment"
                rows="4"
                required
              ></textarea>
            </div>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-paper-plane"></i> Enviar Comentario
            </button>
          </form>
        </div>

        <!-- Lista de comentarios -->
        <div class="comments-section">
          <h3 class="mb-4"><i class="fas fa-comment-dots"></i> Comentarios</h3>
          <div id="commentsList">
            <div class="no-comments">
              <i class="fas fa-comment-slash fa-3x mb-3"></i>
              <p>No hay comentarios aún. ¡Sé el primero en comentar!</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
      // JavaScript para manejar el formulario con conexión a base de datos
      document
        .getElementById("commentForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const formData = {
            name: document.getElementById("name").value,
            email: document.getElementById("email").value,
            comment: document.getElementById("comment").value,
          };

          try {
            const response = await fetch("save_comment.php", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            });

            const result = await response.json();

            if (result.success) {
              // Limpiar formulario
              this.reset();

              // Mostrar mensaje de éxito
              showSuccessMessage();

              // Recargar comentarios
              loadComments();
            } else {
              showErrorMessage(result.message);
            }
          } catch (error) {
            showErrorMessage(
              "Error al enviar el comentario. Asegúrate de que los archivos PHP estén configurados."
            );
          }
        });

      // Función para cargar comentarios desde la base de datos
      async function loadComments() {
        try {
          const response = await fetch("get_comments.php");
          const result = await response.json();

          if (result.success) {
            displayComments(result.comments);
          } else {
            console.error("Error al cargar comentarios:", result.message);
          }
        } catch (error) {
          console.error("Error al cargar comentarios:", error);
          // Mostrar mensaje si no hay conexión con PHP
          document.getElementById("commentsList").innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> 
                        No se pudieron cargar los comentarios. Asegúrate de que los archivos PHP estén configurados correctamente.
                    </div>
                `;
        }
      }

      // Función para mostrar comentarios
      function displayComments(comments) {
        const commentsList = document.getElementById("commentsList");

        if (!comments || comments.length === 0) {
          commentsList.innerHTML = `
                    <div class="no-comments">
                        <i class="fas fa-comment-slash fa-3x mb-3"></i>
                        <p>No hay comentarios aún. ¡Sé el primero en comentar!</p>
                    </div>
                `;
          return;
        }

        const commentsHTML = comments
          .map((comment) => {
            const initials = comment.name
              .split(" ")
              .map((word) => word[0])
              .join("")
              .toUpperCase()
              .slice(0, 2);
            const date = new Date(comment.date);

            return `
                    <div class="comment-item">
                        <div class="comment-header">
                            <div class="user-avatar">
                                ${initials}
                            </div>
                            <div class="comment-meta">
                                <div class="username">${comment.name}</div>
                                <div class="comment-date">
                                    <i class="fas fa-clock"></i> ${date.toLocaleDateString(
                                      "es-ES",
                                      {
                                        year: "numeric",
                                        month: "long",
                                        day: "numeric",
                                        hour: "2-digit",
                                        minute: "2-digit",
                                      }
                                    )}
                                </div>
                            </div>
                        </div>
                        <div class="comment-text">
                            ${comment.text.replace(/\n/g, "<br>")}
                        </div>
                    </div>
                `;
          })
          .join("");

        commentsList.innerHTML = commentsHTML;
      }

      // Funciones para mostrar mensajes
      function showSuccessMessage() {
        const alert = document.createElement("div");
        alert.className = "alert alert-success alert-dismissible fade show";
        alert.innerHTML = `
                <i class="fas fa-check-circle"></i> ¡Comentario guardado en la base de datos exitosamente!
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

        const form = document.querySelector(".comment-form");
        form.insertBefore(alert, form.firstChild);

        setTimeout(() => {
          if (alert.parentNode) {
            alert.remove();
          }
        }, 3000);
      }

      function showErrorMessage(message) {
        const alert = document.createElement("div");
        alert.className = "alert alert-danger alert-dismissible fade show";
        alert.innerHTML = `
                <i class="fas fa-exclamation-circle"></i> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

        const form = document.querySelector(".comment-form");
        form.insertBefore(alert, form.firstChild);

        setTimeout(() => {
          if (alert.parentNode) {
            alert.remove();
          }
        }, 5000);
      }

      // Cargar comentarios al inicializar la página
      document.addEventListener("DOMContentLoaded", function () {
        loadComments();
      });
    </script>
  </body>
</html>
